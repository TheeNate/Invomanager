The invoice system has several critical issues that need fixing:
Issue 1: Fix Default Invoice Status
The invoice status should default to DRAFT, not PAID. In database_postgres.py, ensure the Invoices table creation has:
sqlstatus VARCHAR(20) DEFAULT 'DRAFT'
Issue 2: Add Status Selection During Invoice Creation
In templates/create_invoice.html, add a status selection field before the submit buttons:
html<!-- Add this section before the submit buttons -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-flag"></i> Invoice Status</h5>
    </div>
    <div class="card-body">
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="invoice_status" id="status_draft" value="DRAFT" checked>
            <label class="form-check-label" for="status_draft">
                <span class="badge bg-secondary">DRAFT</span> - Work in progress
            </label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="invoice_status" id="status_sent" value="SENT">
            <label class="form-check-label" for="status_sent">
                <span class="badge bg-primary">SENT</span> - Ready for payment
            </label>
        </div>
        <small class="text-muted d-block mt-2">
            You can change the status later. PAID status can only be set after invoice is sent.
        </small>
    </div>
</div>
Issue 3: Update save_invoice Route to Handle Status
In app.py, modify the save_invoice() route to handle the selected status:
python# In save_invoice() route, after creating the invoice:

# Get selected status (default to DRAFT if not provided)
invoice_status = request.form.get('invoice_status', 'DRAFT')

# Only allow DRAFT or SENT on creation
if invoice_status not in ['DRAFT', 'SENT']:
    invoice_status = 'DRAFT'

# Update status after creating invoice and line items
db_manager.update_invoice_status(invoice_id, invoice_status)
Issue 4: Add Edit Invoice Functionality
Create a new route in app.py for editing invoices:
python@app.route('/invoice/<int:invoice_id>/edit')
@auth.require_auth
def edit_invoice(invoice_id):
    """Edit existing invoice"""
    try:
        invoice = db_manager.get_invoice_by_id(invoice_id)
        if not invoice:
            flash('Invoice not found', 'error')
            return redirect(url_for('invoices_list'))
        
        # Only allow editing DRAFT invoices
        if invoice['status'] != 'DRAFT':
            flash('Only DRAFT invoices can be edited', 'warning')
            return redirect(url_for('view_invoice', invoice_id=invoice_id))
        
        return render_template('edit_invoice.html', 
                             invoice=invoice,
                             today=date.today().strftime('%Y-%m-%d'))
        
    except Exception as e:
        flash(f'Error loading invoice for editing: {str(e)}', 'error')
        return redirect(url_for('invoices_list'))

@app.route('/invoice/<int:invoice_id>/update', methods=['POST'])
@auth.require_auth
def update_invoice(invoice_id):
    """Update existing invoice"""
    try:
        # Similar to save_invoice but updates existing invoice
        # Update invoice details
        # Delete old line items and add new ones
        # Recalculate totals
        
        flash('Invoice updated successfully', 'success')
        return redirect(url_for('view_invoice', invoice_id=invoice_id))
        
    except Exception as e:
        flash(f'Error updating invoice: {str(e)}', 'error')
        return redirect(url_for('edit_invoice', invoice_id=invoice_id))
Issue 5: Add Delete Option for All Invoice Statuses
Update templates/view_invoice.html to allow deletion for all statuses with appropriate warnings:
html<!-- Replace the existing Actions dropdown with this improved version -->
{% if invoice.status in ['DRAFT', 'SENT'] %}
<div class="btn-group">
    <button type="button" class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown">
        <i class="bi bi-gear"></i> Actions
    </button>
    <ul class="dropdown-menu">
        {% if invoice.status == 'DRAFT' %}
        <li>
            <a href="{{ url_for('edit_invoice', invoice_id=invoice.invoice_id) }}" class="dropdown-item">
                <i class="bi bi-pencil"></i> Edit Invoice
            </a>
        </li>
        <li>
            <form method="POST" action="{{ url_for('update_invoice_status_route', invoice_id=invoice.invoice_id) }}" style="display: inline;">
                <input type="hidden" name="status" value="SENT">
                <button type="submit" class="dropdown-item">
                    <i class="bi bi-send"></i> Mark as Sent
                </button>
            </form>
        </li>
        {% elif invoice.status == 'SENT' %}
        <li>
            <form method="POST" action="{{ url_for('update_invoice_status_route', invoice_id=invoice.invoice_id) }}" style="display: inline;">
                <input type="hidden" name="status" value="PAID">
                <button type="submit" class="dropdown-item">
                    <i class="bi bi-check-circle"></i> Mark as Paid
                </button>
            </form>
        </li>
        <li>
            <form method="POST" action="{{ url_for('update_invoice_status_route', invoice_id=invoice.invoice_id) }}" style="display: inline;">
                <input type="hidden" name="status" value="DRAFT">
                <button type="submit" class="dropdown-item">
                    <i class="bi bi-arrow-return-left"></i> Return to Draft
                </button>
            </form>
        </li>
        {% endif %}
        <li><hr class="dropdown-divider"></li>
        <li>
            <form method="POST" action="{{ url_for('delete_invoice_route', invoice_id=invoice.invoice_id) }}" 
                  onsubmit="return confirm('Are you sure you want to delete this invoice?')"
                  style="display: inline;">
                <button type="submit" class="dropdown-item text-danger">
                    <i class="bi bi-trash"></i> Delete Invoice
                </button>
            </form>
        </li>
    </ul>
</div>
{% elif invoice.status == 'PAID' %}
<!-- For PAID invoices, provide limited actions -->
<div class="btn-group">
    <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
        <i class="bi bi-gear"></i> Actions
    </button>
    <ul class="dropdown-menu">
        <li>
            <form method="POST" action="{{ url_for('update_invoice_status_route', invoice_id=invoice.invoice_id) }}" style="display: inline;">
                <input type="hidden" name="status" value="SENT">
                <button type="submit" class="dropdown-item" 
                        onclick="return confirm('Are you sure you want to change this PAID invoice back to SENT?')">
                    <i class="bi bi-arrow-return-left"></i> Mark as Unpaid
                </button>
            </form>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li>
            <form method="POST" action="{{ url_for('delete_invoice_route', invoice_id=invoice.invoice_id) }}" 
                  onsubmit="return confirm('WARNING: This is a PAID invoice!\n\nAre you absolutely sure you want to delete this paid invoice?\n\nThis action cannot be undone.')"
                  style="display: inline;">
                <button type="submit" class="dropdown-item text-danger">
                    <i class="bi bi-trash"></i> Delete Invoice
                </button>
            </form>
        </li>
    </ul>
</div>
{% endif %}
Issue 6: Add Edit Button to Invoice List
Update templates/invoices_list.html to include edit buttons for DRAFT invoices:
html<!-- In the actions column, update the button group -->
<div class="btn-group btn-group-sm" role="group">
    <a href="{{ url_for('view_invoice', invoice_id=invoice.invoice_id) }}" 
       class="btn btn-outline-primary" title="View">
        <i class="bi bi-eye"></i>
    </a>
    {% if invoice.status == 'DRAFT' %}
    <a href="{{ url_for('edit_invoice', invoice_id=invoice.invoice_id) }}" 
       class="btn btn-outline-warning" title="Edit">
        <i class="bi bi-pencil"></i>
    </a>
    {% endif %}
    <!-- Rest of the existing action buttons -->
</div>
Issue 7: Create edit_invoice.html Template
Create a new template templates/edit_invoice.html that's similar to create_invoice.html but:

Pre-fills all fields with existing invoice data
Shows the invoice number (read-only)
Allows editing all fields except invoice number
Submits to the update route instead of save route

Expected Results After Fixes:

New invoices default to DRAFT status
Users can choose DRAFT or SENT status when creating invoices
DRAFT invoices can be edited
All invoices can be deleted (with appropriate warnings for PAID invoices)
Invoice status can be changed: DRAFT → SENT → PAID (and reversed if needed)
Better user experience with clear status workflows